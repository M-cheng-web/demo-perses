# Hook 抽取准则

## 目标

在不牺牲可读性的前提下，把跨组件复用的状态机与副作用逻辑收敛到可测试、可复用的 hook。

## 何时抽取

- 同一段业务逻辑在 2 个及以上组件中重复出现。
- 单组件内出现“状态 + watch + 生命周期清理”混杂，且已影响维护（通常 >80 行）。
- 逻辑需要独立测试（例如调度、缓存、overlay、编辑草稿生命周期）。

## 何时不抽

- 只在单组件内出现一次，且逻辑非常短（<30 行）。
- 抽出来后 API 需要透传大量上下文（说明抽象边界还不稳定）。
- 只是为了“文件变小”，但没有复用价值或测试价值。

## 抽取后的验收清单

- `API 清晰`：输入/输出类型稳定，不依赖隐式全局状态。
- `副作用可控`：watch、事件监听、定时器、observer 都有成对清理。
- `边界可测`：至少有脚本级回归（成功路径 + 1 个失败/边界路径）。
- `调用方轻量`：组件只负责组合与渲染，不再承担复杂状态机。

## 推荐流程

1. 先在原组件内把“渲染逻辑”和“行为逻辑”分区。
2. 把行为逻辑移动到 hook，并保持原行为不变。
3. 增加回归脚本，覆盖关键行为。
4. 回到组件层做最小清理（删除重复逻辑、补充类型）。
